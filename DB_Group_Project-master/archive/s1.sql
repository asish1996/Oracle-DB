DROP TABLE VEHICLE CASCADE CONSTRAINTS;
DROP TABLE CLIENT CASCADE CONSTRAINTS;
DROP TABLE RAGREEMENT CASCADE CONSTRAINTS;
DROP TABLE EMPLOYEE CASCADE CONSTRAINTS;
DROP TABLE FAULTREPORT CASCADE CONSTRAINTS;
DROP TABLE OUTLET CASCADE CONSTRAINTS;

CREATE TABLE OUTLET
(
 outNo NUMBER(6) ,
 Street VARCHAR2(20),
 City VARCHAR2(20),
 State CHAR(2),
 ZipCode NUMBER(5),
 Phone NUMBER(10),
 ManagerNo NUMBER(5),
 CONSTRAINT OUTLET_outNo_PK PRIMARY KEY (outNo)
);

CREATE TABLE CLIENT
(
    clientNo NUMBER(20), 
    ClientName VARCHAR2(30), 
    Street VARCHAR2(20), 
    City VARCHAR2(20), 
    State VARCHAR2(2), 
    ZipCode NUMBER(5), 
    WebAddress VARCHAR2(30), 
    Contact_FName VARCHAR2(20),
    Contact_LName VARCHAR2(20), 
    Phone NUMBER(10), 
    Email VARCHAR2(50),
	CONSTRAINT CLIENT_clientNo_PK PRIMARY KEY (clientNo)
);

CREATE TABLE EMPLOYEE
(
 EmpNo NUMBER(5),
 Fname VARCHAR2(20),
 Lname VARCHAR2(20),
 Position VARCHAR2(20),
 Phone NUMBER(10),
 Email VARCHAR2(30),
 DOB DATE,
 Gender VARCHAR2(1),
 Salary NUMBER(10),
 HireDate Date,
 OutNo NUMBER(6),
 SupervisorNo NUMBER(5),
 CONSTRAINT EMPLOYEE_EmpNo_PK PRIMARY KEY (EmpNo),
 CONSTRAINT EMPLOYEE_OutNo_FK 
    FOREIGN KEY (OutNo)
    REFERENCES OUTLET(outNo),
 CONSTRAINT EMPLOYEE_SupervisorNo_FK
    FOREIGN KEY (SupervisorNo)
    REFERENCES EMPLOYEE(EmpNo),
 CONSTRAINT EMPLOYEE_HireDate_CK	
	CHECK (MONTHS_BETWEEN(HireDate, DOB) >= 14*12),
 CONSTRAINT EMPLOYEE_Email_CK	
	CHECK(Email LIKE '%@car_rental.com'),
 CONSTRAINT EMPLOYEE_Gender_CK	
	CHECK(Gender IN ('F','M','O'))
);
 
CREATE TABLE VEHICLE
(
    LicenseNo VARCHAR2(20), 
	Make VARCHAR2(30), 
	Model VARCHAR2(30), 
	Color VARCHAR2(15), 
	Year NUMBER(4), 
	NoDoors NUMBER(1), 
	Capacity NUMBER(2), 
	DailyRate NUMBER(6,2), 
	InspectionDate DATE, 
	outNo NUMBER(6),
	CONSTRAINT VEHICLE_LicenseNo_PK PRIMARY KEY (LicenseNo),
	CONSTRAINT VEHICLE_outNo_FK 
    FOREIGN KEY (outNo)
    REFERENCES OUTLET(outNo)
);

CREATE TABLE RAGREEMENT
(
    RentalNo NUMBER(20), 
	StartDate DATE, 
	ReturnDate DATE, 
	MileageBefore NUMBER(10), 
	MileageAfter NUMBER(10), 
	InsuranceType VARCHAR2(40),
    ClientNo NUMBER(20), 
	LicenseNo VARCHAR2(16),
	CONSTRAINT RAGREEMENT_RentalNo_PK PRIMARY KEY (RentalNo),
	CONSTRAINT RAGREEMENT_ClientNo_FK
		FOREIGN KEY (ClientNo)
		REFERENCES CLIENT(clientNo),
	CONSTRAINT RAGREEMENT_LicenseNo_FK
		FOREIGN KEY (LicenseNo)
		REFERENCES VEHICLE(LicenseNo),
	CONSTRAINT RAGREEMENT_ReturnDate_CK
		CHECK (ReturnDate >= StartDate),
	CONSTRAINT RAGREEMENT_MlgAft_CK
		CHECK (MileageAfter >= MileageBefore)
);

CREATE TABLE FAULTREPORT
(
 ReportNum NUMBER(10),
 DateChecked DATE,
 Comments VARCHAR2(100),
 EmpNo NUMBER(5),
 LicenseNo VARCHAR2(20),
 RentalNo NUMBER(20), 
 CONSTRAINT FAULTREPORT_ReportNum_PK PRIMARY KEY (ReportNum),
 CONSTRAINT FAULTREPORT_EmpNo_FK
	FOREIGN KEY (EmpNo)
	REFERENCES EMPLOYEE(EmpNo),
 CONSTRAINT FAULTREPORT_LicenseNo_FK
	FOREIGN KEY (LicenseNo)
	REFERENCES VEHICLE(LicenseNo),
 CONSTRAINT FAULTREPORT_RentalNo_FK
	FOREIGN KEY (RentalNo)
	REFERENCES RAGREEMENT(RentalNo)
);

ALTER TABLE OUTLET
	ADD CONSTRAINT OUTLET_ManagerNo_FK
	FOREIGN KEY (ManagerNo)
	REFERENCES EMPLOYEE(EmpNo);

